<% layout("/layout/new") %>

<style>
/* ===== Mentor List – Formal Light Styling (no JS/backend changes) ===== */
:root{
  --bg:#f9fafb; --surface:#ffffff; --border:#e5e7eb;
  --text:#111827; --muted:#6b7280; --accent:#16a34a;
}
body{ background:var(--bg); color:var(--text); }

.section-head{
  display:flex; align-items:center; justify-content:space-between;
  gap:1rem; margin:16px 0 8px;
}
.section-head h3{ margin:0; font-weight:800; }
.section-head .btn{ border-radius:10px; }

/* Search bar */
.search-wrap{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:12px;
  padding:.75rem;
  margin:6px 0 14px 0;
}
.search-wrap .form-control{
  border-radius:10px;
  border:1px solid var(--border);
  padding:.6rem .9rem;
}
.search-wrap .btn{
  border-radius:10px;
}
.search-meta{
  color:var(--muted); font-size:.9rem;
}

/* Cards */
.mentor-grid .card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:12px;
  transition:transform .15s ease, border-color .15s ease, box-shadow .15s ease;
}
.mentor-grid .card:hover{
  transform: translateY(-3px);
  border-color:#cfe7d6;
  box-shadow:0 3px 10px rgba(0,0,0,.05);
}
.mentor-grid .card:focus-within{ outline:2px solid #a7f3d0; outline-offset:2px; }

.mentor-grid .card-img-top{
  width:100%;
  aspect-ratio: 16 / 10;
  object-fit: cover;
  border-top-left-radius:12px;
  border-top-right-radius:12px;
}

.card-title{ font-weight:700; margin-bottom:.25rem; }
.card-text{ color:var(--muted); margin:0; }

.card-link{ display:block; text-decoration:none; color:inherit; }
.card-link:focus-visible{ outline:2px solid #34d399; border-radius:12px; }

.empty-state{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:12px;
}

@media (max-width: 575.98px){
  .section-head{ flex-direction:column; align-items:flex-start; }
}
</style>

<div class="container py-3">

  <!-- Header -->
  <div class="section-head">
    <h3 class="mb-0">Mentors</h3>
    <a href="/mentor/new" class="btn btn-success"><i class="bi bi-person-plus me-1"></i>List as a Mentor</a>
  </div>

  <!-- Search toolbar (client-side only) -->
  <div class="search-wrap">
    <form class="row g-2 align-items-center" onsubmit="return false;">
      <div class="col-12 col-md-8">
        <input id="mentorSearchInput" type="text" class="form-control" placeholder="Search mentors by name or expertise…">
      </div>
      <div class="col-6 col-md-auto">
        <button id="mentorSearchBtn" class="btn btn-success w-100"><i class="bi bi-search me-1"></i>Search</button>
      </div>
      <div class="col-6 col-md-auto">
        <button id="mentorClearBtn" class="btn btn-outline-secondary w-100" type="button">Clear</button>
      </div>
      <div class="col-12">
        <div class="search-meta"><span id="mentorCount"></span></div>
      </div>
    </form>
  </div>

  <!-- Grid -->
  <div id="mentorGrid" class="row mentor-grid row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
    <% for (men of mentor) { %>
      <div class="col mentor-card"
           data-name="<%= (men.name || '').toLowerCase() %>"
           data-expertise="<%= (men.expertise || '').toLowerCase() %>">
        <a href="/mentor/<%= men.id %>" class="card-link">
          <div class="card h-100">
            <img src="<%= men.photo %>" alt="<%= men.name %>" loading="lazy" class="card-img-top">
            <div class="card-body">
              <h5 class="card-title"><%= men.name %></h5>
              <p class="card-text"><%= men.expertise %></p>
            </div>
          </div>
        </a>
      </div>
    <% } %>
  </div>

  <!-- Empty state (server-side) -->
  <% if (!mentor || mentor.length === 0) { %>
    <div class="empty-state text-center text-muted py-5 mt-3">
      <i class="bi bi-people display-6 d-block mb-2"></i>
      <p class="mb-3">No mentors yet. Be the first to list.</p>
      <a href="/mentor/new" class="btn btn-success">List as a Mentor</a>
    </div>
  <% } %>
</div>

<script>
/* Scoped, page-only client-side filter (no backend/JS changes) */
(function(){
  const input = document.getElementById('mentorSearchInput');
  const btn = document.getElementById('mentorSearchBtn');
  const clear = document.getElementById('mentorClearBtn');
  const cards = Array.from(document.querySelectorAll('.mentor-card'));
  const countEl = document.getElementById('mentorCount');

  function normalize(s){ return (s || '').toLowerCase().trim(); }
  function tokens(q){ return normalize(q).split(/\s+/).filter(Boolean); }

  function applyFilter(){
    const q = input.value;
    const tks = tokens(q);
    let visible = 0;

    cards.forEach(card => {
      const hay = (card.dataset.name + ' ' + card.dataset.expertise);
      const ok = tks.every(t => hay.includes(t));
      card.style.display = ok ? '' : 'none';
      if(ok) visible++;
    });

    // Update count text
    const total = cards.length;
    countEl.textContent = q
      ? `${visible} of ${total} mentors match “${q}”`
      : `Showing all ${total} mentors`;
  }

  // Events
  btn.addEventListener('click', applyFilter);
  input.addEventListener('input', applyFilter);
  input.addEventListener('keyup', (e)=>{ if(e.key === 'Enter') applyFilter(); });
  clear.addEventListener('click', ()=>{
    input.value = '';
    applyFilter();
    input.focus();
  });

  // Init count on load
  applyFilter();
})();
</script>
